# ATP_re 使用者操作手冊

**版本：** 1.0  
**更新日期：** 2025-11-09  
**適用系統：** ATP_re Java 版本

---

## 📖 目錄

1. [系統簡介](#系統簡介)
2. [安裝與設定](#安裝與設定)
3. [啟動系統](#啟動系統)
4. [基本操作](#基本操作)
5. [功能模組使用](#功能模組使用)
6. [資料管理](#資料管理)
7. [報表產出](#報表產出)
8. [常見問題](#常見問題)
9. [鍵盤快捷鍵](#鍵盤快捷鍵)

---

## 系統簡介

### 什麼是 ATP_re？

ATP_re（Automatic Train Protection - Refactored）是一個鐵路列車自動防護系統的資料分析與管理工作站軟體。系統主要功能包括：

- **資料收集**：從 RU（Recording Unit）和 MMI（Man-Machine Interface）設備收集行車記錄
- **資料解碼**：解析二進位格式的行車記錄檔案
- **資料分析**：多維度分析行車狀態、事件、速度曲線等
- **視覺化呈現**：以圖表方式展示分析結果
- **報表產出**：生成組員考核、異常事件等報表

### 系統架構

```
┌─────────────────────────────────────┐
│     使用者介面 (UI)                  │
│  - 主選單、工具列                    │
│  - 資料瀏覽器                        │
│  - 圖表顯示區                        │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│     解碼引擎                         │
│  - RU 解碼器                         │
│  - MMI 解碼器                        │
│  - BTM 解碼器                        │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│     資料存取層                       │
│  - 資料庫連線                        │
│  - 檔案 I/O                          │
│  - FTP 連線                          │
└─────────────────────────────────────┘
```

---

## 安裝與設定

### 系統需求

#### 硬體需求
- **處理器：** Intel Core i5 或以上
- **記憶體：** 4GB RAM（建議 8GB）
- **硬碟空間：** 500MB 程式空間 + 資料儲存空間
- **顯示器：** 1280x720 或更高解析度

#### 軟體需求
- **作業系統：** Windows 7/8/10/11 或 macOS 10.12+
- **Java Runtime Environment：** JRE 8 或以上版本
- **資料庫：** SQL Server 2008 或以上（選用）

### 安裝步驟

#### Windows 安裝

1. **安裝 Java Runtime Environment**
   ```
   - 下載 JRE 8+ 從 https://www.java.com/
   - 執行安裝程式
   - 完成安裝後，驗證安裝：
     開啟命令提示字元，輸入：java -version
   ```

2. **解壓縮 ATP_re 程式**
   ```
   - 解壓縮 ATP_re.zip 到目標資料夾
   - 建議路徑：C:\Program Files\ATP_re\
   ```

3. **設定資料庫連線**（選用）
   ```
   - 編輯 config/database.properties
   - 設定資料庫伺服器位址、使用者名稱、密碼
   ```

4. **驗證安裝**
   ```
   - 執行 ATP_re.bat
   - 確認系統正常啟動
   ```

#### macOS 安裝

1. **安裝 Java Runtime Environment**
   ```bash
   # 檢查是否已安裝 Java
   java -version
   
   # 如未安裝，從 https://www.java.com/ 下載安裝
   # 或使用 Homebrew：
   brew install openjdk@8
   ```

2. **解壓縮 ATP_re 程式**
   ```bash
   # 解壓縮到應用程式資料夾
   unzip ATP_re.zip -d /Applications/ATP_re/
   
   # 設定執行權限
   chmod +x /Applications/ATP_re/ATP_re.sh
   ```

3. **設定資料庫連線**（選用）
   ```bash
   # 編輯設定檔
   vi /Applications/ATP_re/config/database.properties
   ```

4. **驗證安裝**
   ```bash
   # 執行程式
   /Applications/ATP_re/ATP_re.sh
   ```

### 初次設定

1. **語言設定**
   - 啟動系統後，選擇「設定」→「語言」
   - 選擇繁體中文或英文

2. **資料路徑設定**
   - 選擇「設定」→「路徑設定」
   - 設定 RU 檔案路徑
   - 設定 MMI 檔案路徑
   - 設定報表輸出路徑

3. **FTP 設定**（如需自動下載資料）
   - 選擇「設定」→「FTP 設定」
   - 輸入 FTP 伺服器位址、埠號
   - 輸入使用者名稱、密碼
   - 測試連線

---

## 啟動系統

### Windows 啟動

1. **使用捷徑**
   - 雙擊桌面的 ATP_re 圖示

2. **使用批次檔**
   ```cmd
   C:\Program Files\ATP_re\ATP_re.bat
   ```

3. **使用命令列**
   ```cmd
   cd C:\Program Files\ATP_re
   java -jar ATP_re.jar
   ```

### macOS 啟動

1. **使用應用程式**
   - 開啟「應用程式」資料夾
   - 雙擊 ATP_re 圖示

2. **使用 Shell 腳本**
   ```bash
   /Applications/ATP_re/ATP_re.sh
   ```

3. **使用終端機**
   ```bash
   cd /Applications/ATP_re
   java -jar ATP_re.jar
   ```

### 啟動參數

系統支援以下啟動參數：

```bash
java -jar ATP_re.jar [參數]

參數：
  -config <path>      指定設定檔路徑
  -debug              啟用除錯模式
  -log <path>         指定日誌檔路徑
  -nogui              無圖形介面模式（僅解碼）
  -memory <size>      指定最大記憶體（例如：-memory 2048m）

範例：
  java -Xmx2048m -jar ATP_re.jar -config custom.properties -debug
```

---

## 基本操作

### 主視窗介紹

```
┌──────────────────────────────────────────────────────────┐
│  檔案  編輯  檢視  工具  說明                              │  ← 選單列
├──────────────────────────────────────────────────────────┤
│  [開啟] [儲存] [列印] [解碼] [分析] [圖表]                │  ← 工具列
├──────────────────────────────────────────────────────────┤
│                                                           │
│  ┌──────────┐  ┌────────────────────────────────────┐   │
│  │          │  │                                     │   │
│  │  資料    │  │        主要顯示區域                 │   │
│  │  清單    │  │     （圖表、資料表、分析結果）      │   │
│  │          │  │                                     │   │
│  │          │  │                                     │   │
│  └──────────┘  └────────────────────────────────────┘   │
│                                                           │
├──────────────────────────────────────────────────────────┤
│  狀態列：就緒 | 記錄數：0 | 已選擇：0                    │  ← 狀態列
└──────────────────────────────────────────────────────────┘
```

### 檔案操作

#### 開啟 RU 檔案

1. 點擊「檔案」→「開啟 RU 檔案」
2. 瀏覽至檔案位置
3. 選擇檔案（副檔名：.RU）
4. 點擊「開啟」
5. 系統自動開始解碼

#### 開啟 MMI 檔案

1. 點擊「檔案」→「開啟 MMI 檔案」
2. 瀏覽至檔案位置
3. 選擇檔案（副檔名：.MMI）
4. 點擊「開啟」
5. 系統自動開始解碼

#### 批次處理

1. 點擊「檔案」→「批次處理」
2. 選擇資料夾
3. 設定篩選條件（日期範圍、車次等）
4. 點擊「開始處理」
5. 等待處理完成

### 資料瀏覽

#### 資料清單操作

- **排序**：點擊欄位標題進行排序
- **篩選**：在篩選框輸入條件
- **搜尋**：使用 Ctrl+F 快速搜尋
- **選擇**：點擊列選擇，Ctrl+點擊多選

#### 詳細資料檢視

1. 在資料清單中選擇一筆記錄
2. 雙擊或按 Enter 開啟詳細檢視
3. 切換不同標籤頁查看各類資訊
4. 點擊「關閉」返回清單

---

## 功能模組使用

### 1. RU 資料解碼

#### 解碼單一檔案

1. **開啟檔案**
   - 檔案 → 開啟 RU 檔案
   - 或工具列點擊「開啟」按鈕

2. **檢視解碼進度**
   - 解碼進度條顯示處理進度
   - 狀態列顯示目前處理狀態

3. **檢視解碼結果**
   - 解碼完成後，資料顯示於主畫面
   - 左側清單顯示各記錄項目
   - 右側顯示詳細資訊

#### 解碼內容說明

RU 檔案包含以下資訊：

- **車次資訊**：車次號、行駛方向、時間
- **速度記錄**：實際速度、目標速度、限速
- **位置資訊**：公里標、區間、車站
- **事件記錄**：ATP 事件、警示、故障
- **BTM 資訊**：應答器訊息、位置修正

### 2. MMI 資料解碼

#### MMI 檔案結構

MMI 檔案記錄駕駛室人機介面的顯示資訊：

- **DMI 畫面**：駕駛室顯示器內容
- **按鍵操作**：駕駛員操作記錄
- **警示訊息**：ATP 警示與提醒
- **狀態變化**：系統模式切換

#### 解碼步驟

1. 開啟 MMI 檔案
2. 選擇解碼選項：
   - 完整解碼：解析所有封包
   - 快速解碼：僅解析關鍵訊息
   - 自訂解碼：選擇特定封包類型
3. 檢視解碼結果

### 3. 速度曲線分析

#### 繪製速度曲線

1. **選擇資料**
   - 在資料清單選擇行車記錄
   
2. **開啟圖表**
   - 點擊「圖表」→「速度曲線」
   - 或使用快捷鍵 Ctrl+G

3. **設定顯示選項**
   - 時間軸 / 距離軸切換
   - 顯示 / 隱藏目標速度
   - 顯示 / 隱藏限速曲線
   - 標記事件點

4. **圖表操作**
   - 滑鼠滾輪：縮放
   - 拖曳：平移檢視範圍
   - 右鍵選單：匯出、列印

#### 曲線分析功能

- **速度分析**
  - 最高速度、平均速度
  - 加速度、減速度
  - 速度分布統計

- **事件標記**
  - ATP 煞車點
  - 限速變化點
  - 異常事件點

- **比對分析**
  - 多次行車比對
  - 標準曲線比對
  - 異常偵測

### 4. 事件分析

#### 事件類型

系統記錄以下事件類型：

| 事件代碼 | 事件名稱 | 嚴重程度 |
|---------|---------|---------|
| E001 | ATP 服務煞車 | 高 |
| E002 | ATP 緊急煞車 | 極高 |
| E003 | 超速警示 | 中 |
| E004 | SPAD 警告 | 高 |
| E005 | BTM 讀取失敗 | 低 |
| E006 | 系統故障 | 高 |

#### 事件查詢

1. **開啟事件查詢**
   - 工具 → 事件查詢
   
2. **設定查詢條件**
   - 時間範圍
   - 事件類型
   - 嚴重程度
   - 車次號碼

3. **檢視查詢結果**
   - 事件清單
   - 事件詳情
   - 關聯資料

4. **匯出結果**
   - Excel 格式
   - CSV 格式
   - PDF 報表

### 5. 停車精準度分析

#### 分析項目

- **停車位置偏差**：實際停車點與目標停車點的距離差
- **停車速度**：停車時的速度
- **停車時間**：從進站到完全停止的時間
- **平穩度**：停車過程的加速度變化

#### 操作步驟

1. 選擇「分析」→「停車精準度」
2. 選擇要分析的車站
3. 設定分析期間
4. 檢視分析結果：
   - 統計圖表
   - 趨勢分析
   - 異常值標記

### 6. 組員考核

#### 考核項目

系統可自動產生以下考核資料：

- **安全項目**
  - ATP 事件次數
  - 超速次數
  - 異常煞車次數

- **服務品質**
  - 停車精準度
  - 準點率
  - 平穩度評分

- **操作規範**
  - 按鈕操作正確性
  - 回應時間
  - 標準程序遵守率

#### 產生考核報表

1. 選擇「報表」→「組員考核」
2. 選擇組員與期間
3. 選擇考核項目
4. 產生報表
5. 列印或匯出

---

## 資料管理

### 資料庫管理

#### 資料庫連線設定

```properties
# config/database.properties
db.host=localhost
db.port=1433
db.name=ATP_DB
db.user=atp_user
db.password=******
db.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver
```

#### 資料備份

1. **自動備份**
   - 設定 → 資料備份 → 自動備份
   - 設定備份時間與頻率
   - 選擇備份位置

2. **手動備份**
   - 工具 → 資料庫 → 備份
   - 選擇備份位置
   - 輸入備份檔名
   - 點擊「開始備份」

#### 資料還原

1. 工具 → 資料庫 → 還原
2. 選擇備份檔案
3. 確認還原選項
4. 點擊「開始還原」
5. 等待完成並重新啟動系統

### 檔案管理

#### 資料整理

系統會在以下位置儲存檔案：

```
ATP_re/
├── data/
│   ├── ru/          # RU 原始檔案
│   ├── mmi/         # MMI 原始檔案
│   └── decoded/     # 已解碼資料
├── reports/         # 產生的報表
├── logs/            # 系統日誌
└── backup/          # 備份檔案
```

#### 清理舊資料

1. 工具 → 資料管理 → 清理
2. 設定保留期限
3. 選擇要清理的資料類型
4. 預覽要刪除的檔案
5. 確認並執行清理

---

## 報表產出

### 報表類型

#### 1. 行車記錄報表

包含完整的行車資訊：
- 車次資訊
- 速度曲線
- 事件記錄
- 停車記錄

#### 2. 事件摘要報表

彙整特定期間的所有事件：
- 事件統計
- 嚴重程度分布
- 趨勢分析

#### 3. 組員考核報表

個人或團隊的績效評估：
- 考核分數
- 項目明細
- 比較分析

#### 4. 異常分析報表

針對異常狀況的深入分析：
- 異常事件清單
- 原因分析
- 改善建議

### 報表產生步驟

1. **選擇報表類型**
   - 點擊「報表」選單
   - 選擇要產生的報表類型

2. **設定報表參數**
   - 時間範圍
   - 篩選條件
   - 顯示選項

3. **預覽報表**
   - 檢查報表內容
   - 調整格式設定

4. **匯出或列印**
   - 匯出格式：PDF、Excel、Word
   - 列印設定：紙張大小、方向、邊界

### 報表自訂

#### 建立自訂範本

1. 報表 → 範本管理 → 新增
2. 選擇基礎範本
3. 編輯欄位與格式
4. 儲存範本

#### 使用自訂範本

1. 產生報表時選擇「使用範本」
2. 選擇已儲存的範本
3. 填入參數
4. 產生報表

---

## 常見問題

### 安裝與設定問題

**Q1: 系統無法啟動，顯示「找不到 Java」錯誤？**

A: 請確認已安裝 Java Runtime Environment：
```bash
# Windows: 命令提示字元
java -version

# macOS: 終端機
java -version
```
如未安裝，請至 https://www.java.com/ 下載安裝。

**Q2: 資料庫連線失敗？**

A: 檢查以下項目：
1. 資料庫服務是否啟動
2. 連線資訊是否正確（config/database.properties）
3. 防火牆是否阻擋連線
4. 使用者權限是否足夠

**Q3: 系統執行速度很慢？**

A: 可以嘗試：
1. 增加 JVM 記憶體：`java -Xmx2048m -jar ATP_re.jar`
2. 清理舊資料
3. 優化資料庫索引
4. 檢查磁碟空間

### 操作問題

**Q4: 無法開啟 RU 檔案？**

A: 確認：
1. 檔案格式是否正確
2. 檔案是否損毀
3. 是否有讀取權限
4. 檔案路徑是否包含特殊字元

**Q5: 解碼後資料不完整？**

A: 可能原因：
1. 原始檔案已損毀
2. 檔案格式版本不符
3. 解碼器版本過舊
請檢查檔案完整性或聯絡技術支援。

**Q6: 圖表無法顯示？**

A: 檢查：
1. 是否已選擇資料
2. 資料範圍是否有效
3. 顯示設定是否正確
4. 嘗試重新繪製圖表

### 資料問題

**Q7: 如何批次處理大量檔案？**

A: 使用批次處理功能：
1. 檔案 → 批次處理
2. 選擇資料夾
3. 設定處理選項
4. 可在背景執行

**Q8: 報表匯出失敗？**

A: 可能原因：
1. 磁碟空間不足
2. 沒有寫入權限
3. 檔案名稱衝突
4. 報表內容過大

解決方法：
1. 清理磁碟空間
2. 檢查資料夾權限
3. 使用不同檔名
4. 分段匯出資料

**Q9: 如何匯入舊版本的資料？**

A: 系統支援向下相容：
1. 工具 → 資料轉換
2. 選擇舊版本檔案
3. 選擇目標格式
4. 執行轉換

### 效能問題

**Q10: 系統記憶體不足？**

A: 優化建議：
```bash
# 增加 JVM 最大記憶體
java -Xms512m -Xmx2048m -jar ATP_re.jar

# 定期清理暫存
java -XX:+UseG1GC -jar ATP_re.jar
```

---

## 鍵盤快捷鍵

### 通用快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| Ctrl + O | 開啟檔案 |
| Ctrl + S | 儲存 |
| Ctrl + P | 列印 |
| Ctrl + W | 關閉視窗 |
| Ctrl + Q | 結束程式 |
| F1 | 說明 |
| F5 | 重新整理 |

### 編輯快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| Ctrl + C | 複製 |
| Ctrl + V | 貼上 |
| Ctrl + X | 剪下 |
| Ctrl + A | 全選 |
| Ctrl + F | 搜尋 |
| Ctrl + Z | 復原 |
| Ctrl + Y | 重做 |

### 檢視快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| Ctrl + G | 開啟圖表 |
| Ctrl + T | 資料表檢視 |
| Ctrl + D | 詳細資料 |
| Ctrl + L | 日誌檢視 |
| Ctrl + + | 放大 |
| Ctrl + - | 縮小 |
| Ctrl + 0 | 重設縮放 |

### 導航快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| ↑ / ↓ | 上下移動選擇 |
| Page Up / Down | 快速翻頁 |
| Home | 跳至開頭 |
| End | 跳至結尾 |
| Enter | 開啟項目 |
| Esc | 取消 / 關閉 |

---

## 技術支援

### 聯絡方式

- **GitHub Issues：** https://github.com/Lawliet0813/ATP_re/issues
- **專案負責人：** @Lawliet0813
- **文件更新：** 請查看 GitHub 專案頁面

### 回報問題

提交問題時，請提供：

1. **系統資訊**
   - 作業系統版本
   - Java 版本
   - ATP_re 版本

2. **問題描述**
   - 詳細步驟
   - 錯誤訊息
   - 螢幕截圖

3. **相關檔案**
   - 日誌檔（logs/atp.log）
   - 設定檔
   - 問題檔案（如適用）

### 獲取更新

系統更新資訊：
- 查看 GitHub Releases
- 訂閱專案通知
- 查閱 CHANGELOG.md

---

## 附錄

### A. 檔案格式說明

#### RU 檔案格式
- 副檔名：.RU
- 編碼：二進位
- 規格版本：v1.8
- 位元組順序：Big-Endian

#### MMI 檔案格式
- 副檔名：.MMI
- 編碼：二進位
- 規格版本：v3.2
- 封包結構：可變長度

### B. 錯誤代碼對照表

| 錯誤代碼 | 說明 | 處理方式 |
|---------|------|---------|
| ERR-001 | 檔案格式錯誤 | 確認檔案類型與格式 |
| ERR-002 | 記憶體不足 | 增加 JVM 記憶體 |
| ERR-003 | 資料庫連線失敗 | 檢查資料庫設定 |
| ERR-004 | 檔案讀取錯誤 | 檢查檔案權限 |
| ERR-005 | 解碼失敗 | 確認檔案完整性 |

### C. 術語表

| 術語 | 英文 | 說明 |
|------|------|------|
| ATP | Automatic Train Protection | 列車自動防護系統 |
| RU | Recording Unit | 記錄單元 |
| MMI | Man-Machine Interface | 人機介面 |
| BTM | Balise Transmission Module | 應答器傳輸模組 |
| ETCS | European Train Control System | 歐洲列車控制系統 |
| DMI | Driver-Machine Interface | 駕駛員-機器介面 |
| SPAD | Signal Passed At Danger | 冒進信號 |

---

**版權聲明**  
© 2025 ATP_re Project. All rights reserved.

**文件維護**  
如發現文件錯誤或需要補充，請提交 GitHub Issue 或 Pull Request。

---

*最後更新：2025-11-09*  
*文件版本：1.0*
