# ATP 互動式圖表 UI/UX 設計規格書

## 文件資訊
- **版本**: 1.0
- **日期**: 2025-10-28
- **目的**: 定義互動式圖表與自動分析功能的使用者介面與體驗設計

## 目錄
1. [設計原則](#1-設計原則)
2. [介面架構](#2-介面架構)
3. [頁面設計](#3-頁面設計)
4. [組件設計](#4-組件設計)
5. [互動設計](#5-互動設計)
6. [視覺設計](#6-視覺設計)
7. [響應式設計](#7-響應式設計)
8. [無障礙設計](#8-無障礙設計)

---

## 1. 設計原則

### 1.1 核心原則

#### 1.1.1 簡潔明瞭 (Simplicity)
- 一目了然的數據呈現
- 減少不必要的視覺元素
- 清晰的資訊層級

#### 1.1.2 高效操作 (Efficiency)
- 最少點擊次數達成目標
- 智能預設值
- 快捷鍵支援

#### 1.1.3 即時回饋 (Immediate Feedback)
- 操作立即反應
- 載入狀態清晰
- 錯誤提示友善

#### 1.1.4 專業可靠 (Professional)
- 符合鐵路專業標準
- 數據精確呈現
- 穩定一致的體驗

### 1.2 設計目標

| 目標 | 指標 |
|------|------|
| 學習時間 | 新用戶 < 15 分鐘上手 |
| 任務完成率 | > 95% |
| 用戶滿意度 | > 4.5/5 |
| 載入時間 | < 2 秒 |

---

## 2. 介面架構

### 2.1 整體佈局

```
┌─────────────────────────────────────────────────────────────┐
│  Header (頂部導航欄)                                        │
│  Logo | 任務選擇 | 視圖切換 | 使用者資訊                    │
├─────────────────────────────────────────────────────────────┤
│  Sidebar │  Main Content Area                               │
│  (左側欄) │  ┌──────────────────────────────────────────┐  │
│           │  │  Control Panel (控制面板)               │  │
│  • 任務列表│  │  時間範圍 | 圖層控制 | 導出               │  │
│  • 篩選器  │  └──────────────────────────────────────────┘  │
│  • 快速統計│  ┌──────────────────────────────────────────┐  │
│           │  │  Interactive Chart (互動式圖表)         │  │
│           │  │                                          │  │
│           │  │  [速度曲線圖]                            │  │
│           │  │                                          │  │
│           │  └──────────────────────────────────────────┘  │
│           │  ┌──────────────────────────────────────────┐  │
│           │  │  Event Timeline (事件時間軸)            │  │
│           │  └──────────────────────────────────────────┘  │
│           │  ┌────────┬────────┬────────┬────────┐        │
│           │  │  速度   │  事件   │  異常   │  建議   │       │
│           │  │  統計   │  列表   │  偵測   │  報告   │       │
│           │  └────────┴────────┴────────┴────────┘        │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 導航結構

```
ATP 分析系統
├── 儀表板 (Dashboard)
│   ├── 任務概覽
│   ├── 今日統計
│   └── 快速分析
├── 互動式分析 (Interactive Analysis) ← 新增
│   ├── 速度曲線分析
│   ├── 事件時間軸
│   └── 異常偵測
├── 報告中心 (Reports)
│   ├── 自動生成報告
│   ├── 歷史報告
│   └── 自訂報告
├── 數據管理 (Data Management)
│   ├── 任務列表
│   ├── 數據上傳
│   └── 數據匯出
└── 系統設定 (Settings)
    ├── 使用者設定
    ├── 分析參數
    └── 顯示設定
```

---

## 3. 頁面設計

### 3.1 互動式分析主頁面

#### 3.1.1 頁面佈局

```
┌─────────────────────────────────────────────────────────────┐
│  [ATP Logo]  互動式分析  |  任務: T123  |  [使用者: Admin ▾]│
├─────────────────────────────────────────────────────────────┤
│ 左側欄(240px) │  主內容區                                    │
├───────────────┼─────────────────────────────────────────────┤
│               │  控制面板                                    │
│ 📋 任務列表   │  ┌───────────────────────────────────────┐  │
│ • T123 ✓     │  │ 🕐 時間範圍: [10:00 - 11:00] ▾       │  │
│ • T124       │  │ 📊 X軸模式: ◉ 時間  ○ 距離           │  │
│ • T125       │  │ 🎨 圖層: ☑速度 ☑事件 ☐坡度          │  │
│              │  │ 📥 導出: [PNG] [SVG] [數據]          │  │
│ 🔍 篩選器     │  └───────────────────────────────────────┘  │
│ 日期: [▾]    │                                              │
│ 司機: [▾]    │  主圖表區                                    │
│ 路線: [▾]    │  ┌───────────────────────────────────────┐  │
│              │  │              速度曲線圖                  │  │
│ 📊 快速統計   │  │  120┤                                  │  │
│ 任務: 25     │  │   90├─────╱╲╱──╲╱╲╱─────             │  │
│ 異常: 3      │  │   60├───╱    ╲╱  ╲╱╲╱╲──────         │  │
│ 報告: 12     │  │   30├─╱                ╲──────        │  │
│              │  │    0└──────────────────────────────>  │  │
│              │  │      10:00  10:15  10:30  10:45      │  │
│              │  │  [+] [-] [⟲] [📍] [✂]                │  │
│              │  └───────────────────────────────────────┘  │
│              │                                              │
│              │  事件時間軸                                  │
│              │  ┌───────────────────────────────────────┐  │
│              │  │  🚉 ┃ ⚠ ┃  ┃🚉┃   ⚠  ┃    🚉  ┃      │  │
│              │  │  10:05 10:15 10:30 10:45              │  │
│              │  └───────────────────────────────────────┘  │
│              │                                              │
│              │  分頁標籤                                    │
│              │  [速度統計] [事件列表] [異常偵測] [建議報告]│
│              │  ┌───────────────────────────────────────┐  │
│              │  │  (當前分頁內容)                        │  │
│              │  └───────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

#### 3.1.2 狀態設計

**載入狀態**:
```
┌───────────────────────────────────────┐
│         載入中...                      │
│    ⟳  正在分析任務數據                │
│       預計需要 3 秒                   │
└───────────────────────────────────────┘
```

**空狀態**:
```
┌───────────────────────────────────────┐
│         📭                            │
│    尚未選擇任務                       │
│    請從左側列表選擇一個任務開始分析   │
│    [瀏覽任務列表]                    │
└───────────────────────────────────────┘
```

**錯誤狀態**:
```
┌───────────────────────────────────────┐
│         ⚠️                            │
│    無法載入任務數據                   │
│    任務 ID 不存在或已被刪除           │
│    [返回] [重試]                      │
└───────────────────────────────────────┘
```

---

## 4. 組件設計

### 4.1 互動式圖表組件

#### 4.1.1 組件結構

```
InteractiveChartComponent
├── ChartCanvas (圖表畫布)
│   ├── SpeedCurve (速度曲線)
│   ├── TargetSpeedCurve (目標速度曲線)
│   ├── EventMarkers (事件標記)
│   └── AnnotationZones (標註區域)
├── ToolBar (工具欄)
│   ├── ZoomInButton
│   ├── ZoomOutButton
│   ├── ResetViewButton
│   ├── PanToggle
│   └── SelectModeToggle
├── Legend (圖例)
├── Tooltip (懸停提示)
└── ContextMenu (右鍵選單)
```

#### 4.1.2 視覺規格

**尺寸**:
- 最小高度: 400px
- 推薦高度: 600px
- 最大高度: 800px
- 寬度: 自適應 (min: 800px)

**顏色方案**:
```css
:root {
  /* 主要曲線 */
  --speed-curve: #00ff00;        /* 實際速度: 綠色 */
  --target-speed: #ffd700;       /* 目標速度: 黃色 (WCAG AA compliant) */
  
  /* 事件標記 */
  --event-brake: #ff6600;        /* 煞車: 橙色 */
  --event-overspeed: #ff0000;    /* 超速: 紅色 */
  --event-failure: #ff00ff;      /* 故障: 洋紅 */
  --event-station: #00ff00;      /* 車站: 綠色 */
  
  /* 背景與網格 */
  --chart-background: #1a1a1a;  /* 深灰背景 */
  --grid-line: #333333;          /* 網格線 */
  --grid-line-major: #555555;    /* 主網格線 */
  
  /* 標註區域 */
  --overspeed-zone: rgba(255, 0, 0, 0.2);  /* 半透明紅色 */
  --selection-zone: rgba(0, 120, 255, 0.3); /* 半透明藍色 */
}
```

#### 4.1.3 工具欄設計

```
┌───────────────────────────────────────┐
│  [+] [-] [⟲] [✋] [✂] [📍] [💾] [⚙]  │
│   放  縮  重  平  選  標  儲  設      │
│   大  小  置  移  取  記  存  定      │
└───────────────────────────────────────┘
```

**按鈕規格**:
- 尺寸: 36x36px
- 間距: 8px
- 圓角: 4px
- 懸停效果: 背景變亮 +10%
- 點擊效果: 按下動畫

### 4.2 懸停提示組件

#### 4.2.1 提示框結構

```
┌─────────────────────────────┐
│  📍 數據詳情                │
├─────────────────────────────┤
│  時間: 10:15:23             │
│  距離: 5.240 km             │
│  速度: 75 km/h  ▲ +5        │
│  目標: 80 km/h              │
│  加速度: 0.5 m/s²           │
│─────────────────────────────│
│  最近事件:                  │
│  🚉 通過板橋站 (5.200 km)  │
└─────────────────────────────┘
```

**視覺規格**:
- 背景色: rgba(0, 0, 0, 0.9)
- 文字色: #ffffff
- 邊框: 1px solid #555555
- 圓角: 8px
- 陰影: 0 4px 12px rgba(0,0,0,0.5)
- 箭頭: 指向數據點

#### 4.2.2 觸發方式
- 滑鼠停留 500ms 顯示
- 滑鼠移開立即隱藏
- 觸控: 點擊顯示，再次點擊隱藏

### 4.3 事件時間軸組件

#### 4.3.1 時間軸設計

```
┌──────────────────────────────────────────────────────────┐
│  事件時間軸                                [篩選 ▾]      │
├──────────────────────────────────────────────────────────┤
│  🚉      🚦      ⚠️       🚉       ⚠️        🚉         │
│  │       │       │        │        │         │          │
│  10:00  10:15  10:23    10:30    10:45     11:00       │
│  板橋   信號   超速     台北     煞車      南港         │
└──────────────────────────────────────────────────────────┘
```

**交互行為**:
- 點擊事件: 主圖表跳轉到對應時間
- 懸停: 顯示事件詳細資訊
- 篩選: 按事件類型篩選顯示

### 4.4 數據面板組件

#### 4.4.1 統計卡片

```
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│  ⏱️ 總時間        │  │  📏 總距離        │  │  🏎️ 最高速度      │
│  52 分鐘         │  │  45.2 km         │  │  90 km/h         │
│  ────────────── │  │  ────────────── │  │  ────────────── │
│  vs 計畫 50 分   │  │  vs 計畫 45 km   │  │  限速 100 km/h   │
│  ⏱️ +2 分 延誤   │  │  ✅ 準時抵達     │  │  ✅ 未超速       │
└──────────────────┘  └──────────────────┘  └──────────────────┘
```

#### 4.4.2 詳細數據表

```
┌─────────────────────────────────────────────────────────┐
│  選定區域統計 (10:15:00 - 10:30:00)                     │
├─────────────────────────────────────────────────────────┤
│  項目          │  數值      │  與整體比較                │
├───────────────┼───────────┼───────────────────────────┤
│  平均速度      │  68 km/h   │  ▲ +3 km/h (高於平均)     │
│  最高速度      │  85 km/h   │  ▼ -5 km/h (低於最高)     │
│  事件數量      │  5 件      │  33% 集中在此區段         │
│  超速次數      │  1 次      │  20% 的超速事件           │
│  行駛距離      │  12.5 km   │  28% 的總距離             │
└─────────────────────────────────────────────────────────┘
```

### 4.5 圖層控制組件

```
┌─────────────────────────────┐
│  圖層控制  [全選] [全不選]  │
├─────────────────────────────┤
│  ☑ 速度曲線      👁️ 🎨     │
│  ☑ 目標速度      👁️ 🎨     │
│  ☑ 事件標記      👁️ 🎨     │
│  ☐ 煞車點        👁️ 🎨     │
│  ☑ 車站位置      👁️ 🎨     │
│  ☐ 坡度曲線      👁️ 🎨     │
│  ☐ 限速標誌      👁️ 🎨     │
│─────────────────────────────│
│  不透明度: ▓▓▓▓▓▓░░░░ 60%  │
└─────────────────────────────┘
```

**功能**:
- 複選框: 開關圖層
- 👁️ 圖示: 顯示/隱藏單一圖層
- 🎨 圖示: 修改圖層顏色
- 滑桿: 調整不透明度

---

## 5. 互動設計

### 5.1 滑鼠互動

| 操作 | 觸發方式 | 行為 |
|------|----------|------|
| 縮放 | 滾輪上/下 | 以滑鼠位置為中心放大/縮小 |
| 平移 | 按住左鍵拖曳 | 移動視圖 |
| 選取 | Shift + 拖曳 | 框選區域 |
| 重置 | 雙擊 | 恢復預設視圖 |
| 懸停 | 停留 0.5s | 顯示數據提示 |
| 右鍵 | 右鍵點擊 | 顯示快捷選單 |

### 5.2 鍵盤互動

| 按鍵 | 功能 |
|------|------|
| `+` / `=` | 放大 |
| `-` | 縮小 |
| `R` | 重置視圖 |
| `G` | 切換網格 |
| `C` | 切換十字準線 |
| `S` | 切換速度曲線 |
| `E` | 切換事件標記 |
| `Space` | 播放/暫停動畫 |
| `←` `→` | 左右平移 |
| `↑` `↓` | 上下平移 |
| `Ctrl+C` | 複製選取數據 |
| `Ctrl+E` | 導出圖表 |
| `Esc` | 取消選取 |

### 5.3 觸控互動

| 手勢 | 功能 |
|------|------|
| 單指拖動 | 平移 |
| 雙指捏合 | 縮放 |
| 雙擊 | 重置視圖 |
| 長按 | 顯示提示 |
| 三指上滑 | 顯示圖層控制 |

### 5.4 動畫與過渡

| 元素 | 動畫類型 | 持續時間 | 緩動函數 |
|------|----------|----------|----------|
| 縮放 | 平滑縮放 | 300ms | ease-out |
| 平移 | 平滑移動 | 200ms | ease-out |
| 圖層切換 | 淡入淡出 | 200ms | ease-in-out |
| 提示顯示 | 淡入 | 150ms | ease-in |
| 提示隱藏 | 淡出 | 100ms | ease-out |
| 載入動畫 | 旋轉 | 1000ms | linear |

---

## 6. 視覺設計

### 6.1 色彩系統

#### 6.1.1 主色調
```css
/* 品牌色 */
--primary-color: #0066cc;        /* 主要藍色 */
--primary-light: #4d94ff;        /* 淺藍色 */
--primary-dark: #004080;         /* 深藍色 */

/* 輔助色 */
--secondary-color: #00cc66;      /* 成功綠色 */
--warning-color: #ff9900;        /* 警告橙色 */
--danger-color: #ff3333;         /* 危險紅色 */
--info-color: #33ccff;           /* 資訊藍色 */

/* 中性色 */
--gray-50: #f9fafb;
--gray-100: #f3f4f6;
--gray-200: #e5e7eb;
--gray-300: #d1d5db;
--gray-400: #9ca3af;
--gray-500: #6b7280;
--gray-600: #4b5563;
--gray-700: #374151;
--gray-800: #1f2937;
--gray-900: #111827;
```

#### 6.1.2 語義色彩
```css
/* 狀態色 */
--status-success: #10b981;       /* 成功 */
--status-warning: #f59e0b;       /* 警告 */
--status-error: #ef4444;         /* 錯誤 */
--status-info: #3b82f6;          /* 資訊 */

/* 圖表色 */
--chart-1: var(--speed-curve-1); /* 速度 */
--chart-2: var(--speed-curve-2); /* 目標速度 */
--chart-3: #ff6600;              /* 煞車 */
--chart-4: #ff0000;              /* 超速 */
--chart-5: #ff00ff;              /* 故障 */
--chart-6: #00ffff;              /* 訊息 */
```

### 6.2 字體系統

```css
/* 字體家族 */
--font-family-base: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
--font-family-mono: "Fira Code", "Consolas", monospace;
--font-family-en: "Inter", "Roboto", sans-serif;

/* 字體大小 */
--font-size-xs: 12px;     /* 極小 */
--font-size-sm: 14px;     /* 小 */
--font-size-base: 16px;   /* 基礎 */
--font-size-lg: 18px;     /* 大 */
--font-size-xl: 20px;     /* 特大 */
--font-size-2xl: 24px;    /* 標題 */
--font-size-3xl: 30px;    /* 大標題 */

/* 字重 */
--font-weight-normal: 400;
--font-weight-medium: 500;
--font-weight-semibold: 600;
--font-weight-bold: 700;

/* 行高 */
--line-height-tight: 1.25;
--line-height-normal: 1.5;
--line-height-relaxed: 1.75;
```

### 6.3 間距系統

```css
/* 間距 (8px 基準) */
--spacing-0: 0;
--spacing-1: 4px;     /* 0.5 單位 */
--spacing-2: 8px;     /* 1 單位 */
--spacing-3: 12px;    /* 1.5 單位 */
--spacing-4: 16px;    /* 2 單位 */
--spacing-5: 20px;    /* 2.5 單位 */
--spacing-6: 24px;    /* 3 單位 */
--spacing-8: 32px;    /* 4 單位 */
--spacing-10: 40px;   /* 5 單位 */
--spacing-12: 48px;   /* 6 單位 */
--spacing-16: 64px;   /* 8 單位 */
```

### 6.4 圓角與陰影

```css
/* 圓角 */
--radius-sm: 4px;
--radius-base: 8px;
--radius-lg: 12px;
--radius-xl: 16px;
--radius-full: 9999px;

/* 陰影 */
--shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
--shadow-base: 0 1px 3px rgba(0, 0, 0, 0.1);
--shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
--shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
--shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);
```

---

## 7. 響應式設計

### 7.1 斷點定義

```css
/* 斷點 */
--breakpoint-xs: 0px;      /* 手機 */
--breakpoint-sm: 640px;    /* 大手機/小平板 */
--breakpoint-md: 768px;    /* 平板 */
--breakpoint-lg: 1024px;   /* 小筆電 */
--breakpoint-xl: 1280px;   /* 桌機 */
--breakpoint-2xl: 1536px;  /* 大桌機 */
```

### 7.2 佈局適配

#### 7.2.1 桌面版 (≥ 1024px)
- 顯示左側欄
- 主圖表高度: 600px
- 顯示完整工具欄

#### 7.2.2 平板版 (768px - 1023px)
- 隱藏左側欄，改為抽屜式
- 主圖表高度: 500px
- 簡化工具欄

#### 7.2.3 手機版 (< 768px)
- 垂直堆疊佈局
- 主圖表高度: 400px
- 最小化工具欄
- 觸控優化互動

---

## 8. 無障礙設計

### 8.1 WCAG 2.1 AA 標準

#### 8.1.1 對比度
- 正常文字: 最少 4.5:1
- 大文字 (18px+): 最少 3:1
- 圖形元素: 最少 3:1

#### 8.1.2 鍵盤導航
- 所有功能可用鍵盤操作
- 可見的焦點指示器
- 合理的 Tab 順序

#### 8.1.3 螢幕閱讀器支援
- 有意義的 alt 文字
- ARIA 標籤
- 語義化 HTML

### 8.2 實作範例

```html
<!-- 圖表容器 -->
<div 
  role="img" 
  aria-label="速度曲線圖，顯示 10:00 至 11:00 的行車速度"
  tabindex="0"
>
  <svg><!-- 圖表內容 --></svg>
</div>

<!-- 工具按鈕 -->
<button 
  aria-label="放大圖表"
  title="放大 (快捷鍵: +)"
  tabindex="0"
>
  <span aria-hidden="true">+</span>
</button>

<!-- 圖層控制 -->
<fieldset>
  <legend>圖層控制</legend>
  <label>
    <input type="checkbox" checked aria-describedby="speed-curve-desc">
    速度曲線
  </label>
  <span id="speed-curve-desc" class="sr-only">
    顯示實際行車速度曲線
  </span>
</fieldset>
```

---

## 附錄

### A. 設計資源

- **圖示庫**: Font Awesome 6.0
- **圖表庫**: Plotly.js 2.0
- **UI 框架**: Streamlit + 自訂 CSS
- **設計工具**: Figma

### B. 瀏覽器支援

| 瀏覽器 | 版本 |
|--------|------|
| Chrome | 90+ |
| Firefox | 88+ |
| Safari | 14+ |
| Edge | 90+ |

### C. 效能指標

| 指標 | 目標值 |
|------|--------|
| 首次內容繪製 (FCP) | < 1.5s |
| 最大內容繪製 (LCP) | < 2.5s |
| 累積佈局偏移 (CLS) | < 0.1 |
| 首次輸入延遲 (FID) | < 100ms |

---

**文件結束**
